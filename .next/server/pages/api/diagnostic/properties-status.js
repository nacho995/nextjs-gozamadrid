"use strict";(()=>{var e={};e.id=181,e.ids=[181],e.modules={1428:e=>{e.exports=import("axios")},8667:(e,o)=>{Object.defineProperty(o,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},17032:(e,o,r)=>{r.a(e,async(e,s)=>{try{r.r(o),r.d(o,{default:()=>c});var t=r(1428),a=e([t]);async function c(e,o){if("GET"!==e.method)return o.status(405).json({error:"M\xe9todo no permitido"});let r={timestamp:new Date().toISOString(),environment:"production",isVercel:!!process.env.VERCEL,sources:{mongodb:{configured:!1,accessible:!1,url:null,urlsTested:[],error:null,properties:0},woocommerce:{configured:!1,accessible:!1,url:null,urlsTested:[],hasCredentials:!1,error:null,properties:0}}},s=["http://gozamadrid-api-prod.eba-adypnjgx.eu-west-3.elasticbeanstalk.com",process.env.NEXT_PUBLIC_API_URL,"http://api.realestategozamadrid.com","http://localhost:8081"].filter(Boolean);for(let e of(r.sources.mongodb.configured=s.length>0,r.sources.mongodb.urlsTested=s,s))try{console.log("[Diagnostic] Probando MongoDB:",e);let o=await t.default.get(`${e}/api/properties`,{timeout:8e3,headers:{Accept:"application/json"}});r.sources.mongodb.accessible=!0,r.sources.mongodb.url=e;let s=[];Array.isArray(o.data)?s=o.data:o.data?.properties&&Array.isArray(o.data.properties)&&(s=o.data.properties),r.sources.mongodb.properties=s.length,console.log(`[Diagnostic] ✅ MongoDB OK: ${s.length} propiedades desde ${e}`);break}catch(o){console.log(`[Diagnostic] ❌ MongoDB fallo: ${e} - ${o.message}`),e===s[s.length-1]&&(r.sources.mongodb.error=o.message)}let a=["https://wordpress.realestategozamadrid.com/wp-json/wc/v3","https://realestategozamadrid.com/wp-json/wc/v3","https://www.realestategozamadrid.com/wp-json/wc/v3"],c=process.env.WC_CONSUMER_KEY||process.env.NEXT_PUBLIC_WOO_COMMERCE_KEY,n=process.env.WC_CONSUMER_SECRET||process.env.NEXT_PUBLIC_WOO_COMMERCE_SECRET;if(r.sources.woocommerce.configured=a.length>0,r.sources.woocommerce.urlsTested=a,r.sources.woocommerce.hasCredentials=!!(c&&n),c&&n)for(let e of a)try{console.log("[Diagnostic] Probando WooCommerce:",e);let o=await t.default.get(`${e}/products`,{params:{consumer_key:c,consumer_secret:n,status:"publish",per_page:5},timeout:1e4,headers:{Accept:"application/json"}});r.sources.woocommerce.accessible=!0,r.sources.woocommerce.url=e,Array.isArray(o.data)&&(r.sources.woocommerce.properties=o.data.length,console.log(`[Diagnostic] ✅ WooCommerce OK: ${o.data.length} propiedades desde ${e}`));break}catch(o){console.log(`[Diagnostic] ❌ WooCommerce fallo: ${e} - ${o.message}`),e===a[a.length-1]&&(r.sources.woocommerce.error=o.message,o.response?.status===401?r.sources.woocommerce.error="Credenciales inv\xe1lidas (401)":o.response?.status===403?r.sources.woocommerce.error="Acceso denegado (403)":"ENOTFOUND"===o.code&&(r.sources.woocommerce.error="Dominio no encontrado"))}else r.sources.woocommerce.error="Credenciales faltantes";let i=Object.values(r.sources).filter(e=>e.accessible).length,l=Object.values(r.sources).reduce((e,o)=>e+o.properties,0);return console.log(`[Diagnostic] Resumen: ${i}/2 fuentes accesibles, ${l} propiedades totales`),o.setHeader("Cache-Control","no-cache"),o.status(200).json({...r,summary:{accessibleSources:i,totalSources:2,totalProperties:l,allWorking:2===i&&l>0,hasData:l>0}})}t=(a.then?(await a)():a)[0],s()}catch(e){s(e)}})},33480:(e,o,r)=>{e.exports=r(75600)},55806:(e,o,r)=>{r.a(e,async(e,s)=>{try{r.r(o),r.d(o,{config:()=>u,default:()=>l,routeModule:()=>d});var t=r(33480),a=r(8667),c=r(86435),n=r(17032),i=e([n]);n=(i.then?(await i)():i)[0];let l=(0,c.M)(n,"default"),u=(0,c.M)(n,"config"),d=new t.PagesAPIRouteModule({definition:{kind:a.A.PAGES_API,page:"/api/diagnostic/properties-status",pathname:"/api/diagnostic/properties-status",bundlePath:"",filename:""},userland:n});s()}catch(e){s(e)}})},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},86435:(e,o)=>{Object.defineProperty(o,"M",{enumerable:!0,get:function(){return function e(o,r){return r in o?o[r]:"then"in o&&"function"==typeof o.then?o.then(o=>e(o,r)):"function"==typeof o&&"default"===r?o:void 0}}})}};var o=require("../../../webpack-api-runtime.js");o.C(e);var r=o(o.s=55806);module.exports=r})();