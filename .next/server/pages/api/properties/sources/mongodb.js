"use strict";(()=>{var e={};e.id=3560,e.ids=[3560],e.modules={1428:e=>{e.exports=import("axios")},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},19084:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{default:()=>c});var a=r(1428),n=r(29021),s=r.n(n),i=r(33873),d=r.n(i),l=e([a]);a=(l.then?(await l)():l)[0];let u="https://nextjs-gozamadrid-qrfk.onrender.com",p=parseInt(process.env.NEXT_PUBLIC_API_TIMEOUT||"30000"),g={};try{let e=d().join(process.cwd(),"coordinates-data.json");if(s().existsSync(e)){let t=s().readFileSync(e,"utf8");g=JSON.parse(t).propertyCoordinates||{},console.log(`ðŸ“ Coordenadas cargadas para ${Object.keys(g).length} propiedades`)}}catch(e){console.log("âš ï¸ No se pudieron cargar las coordenadas:",e.message)}let f=e=>{if(!e)return null;if(g[e])return g[e];for(let[t,r]of Object.entries(g)){let o=e.toLowerCase().trim(),a=t.toLowerCase().trim();if(o.includes(a)||a.includes(o.split(",")[0].trim()))return r}return null},A=e=>Array.isArray(e)?e.map(e=>{if(e.source="mongodb",!e.coordinates&&e.title){let t=f(e.title);t&&(e.coordinates={lat:t.lat,lng:t.lng},console.log(`ðŸ“ Coordenadas agregadas para: ${e.title} -> ${t.lat}, ${t.lng}`))}return e}):[];async function c(e,t){let{limit:r=100,page:o=1}=e.query;console.log(`[API Route MongoDB] Solicitando lista de propiedades. P\xe1gina: ${o}, L\xedmite: ${r}`),console.log(`[API Route MongoDB] Conectando a backend en: ${u}`);try{let e=await a.default.get(`${u}/api/properties`,{params:{limit:r,page:o},timeout:p}),n=[];if(e.data&&Array.isArray(e.data))n=e.data;else if(e.data&&e.data.properties&&Array.isArray(e.data.properties))n=e.data.properties;else if(e.data&&(console.log("[API Route MongoDB] Estructura de respuesta no reconocida:",JSON.stringify(e.data).substring(0,200)+"..."),"object"==typeof e.data)){for(let t in e.data)if(Array.isArray(e.data[t])){n=e.data[t],console.log(`[API Route MongoDB] Encontradas propiedades en clave '${t}'`);break}}let s=A(n);return console.log(`[API Route MongoDB] ${s.length} propiedades encontradas desde ${u}`),console.log(`ðŸ“ Propiedades con coordenadas: ${s.filter(e=>e.coordinates).length}`),t.status(200).json(s)}catch(e){return console.error(`[API Route MongoDB] Error conectando con ${u}:`,e.message),t.status(500).json({error:"Error al conectar con MongoDB",message:e.message,backend_url:u,timestamp:new Date().toISOString()})}}o()}catch(e){o(e)}})},29021:e=>{e.exports=require("fs")},33480:(e,t,r)=>{e.exports=r(75600)},33873:e=>{e.exports=require("path")},34679:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{config:()=>c,default:()=>l,routeModule:()=>u});var a=r(33480),n=r(8667),s=r(86435),i=r(19084),d=e([i]);i=(d.then?(await d)():d)[0];let l=(0,s.M)(i,"default"),c=(0,s.M)(i,"config"),u=new a.PagesAPIRouteModule({definition:{kind:n.A.PAGES_API,page:"/api/properties/sources/mongodb",pathname:"/api/properties/sources/mongodb",bundlePath:"",filename:""},userland:i});o()}catch(e){o(e)}})},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},86435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})}};var t=require("../../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=34679);module.exports=r})();