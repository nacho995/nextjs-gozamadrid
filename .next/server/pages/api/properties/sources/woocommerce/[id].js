"use strict";(()=>{var e={};e.id=8352,e.ids=[8352],e.modules={1428:e=>{e.exports=import("axios")},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return a}});var a=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},33480:(e,t,a)=>{e.exports=a(75600)},44467:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>i});var o=a(1428),n=a(94911),s=e([o]);o=(s.then?(await s)():s)[0];let d={endpoints:["https://wordpress.realestategozamadrid.com/wp-json/wc/v3","https://realestategozamadrid.com/wp-json/wc/v3","https://www.realestategozamadrid.com/wp-json/wc/v3"],credentials:{key:process.env.WC_CONSUMER_KEY,secret:process.env.WC_CONSUMER_SECRET},connection:{timeout:8e3,maxRetries:2,retryDelay:1e3}},c=e=>{try{let t={};e.meta_data?.length&&e.meta_data.forEach(e=>{e.key.startsWith("_")||(t[e.key]=e.value)});let a=e.description||"",r=0,o=0,s=0,i=null,d=a.match(/(\d+)\s*(?:habitacion|dormitorio|bedroom)/i);d&&(r=parseInt(d[1]));let c=a.match(/(\d+)\s*(?:ba√±o|bath|aseo)/i);c&&(o=parseInt(c[1]));let l=a.match(/(\d+)\s*m[¬≤2]?/i);l&&(s=parseInt(l[1]));let p=a.match(/(\d+)[¬™¬∫]?\s*(?:planta|piso)/i);p&&(i=p[1]),r=r||parseInt(t.bedrooms||t.habitaciones)||0,o=o||parseInt(t.ba√±os||t.bathrooms||t.banos)||0,s=s||parseInt(t.living_area||t.area||t.m2||t.superficie)||0,i=i||t.Planta||t.planta||null,0===r&&(r=2),0===o&&(o=1),0===s&&(s=80);let u=(0,n.hM)(e.price);return{id:String(e.id),title:e.title||e.name||`Propiedad ${e.id}`,description:e.description||e.short_description||"",price:u,source:"woocommerce_real",images:e.images?.map(t=>({url:t.url||t.src,alt:t.alt||e.title||e.name||"Imagen de propiedad"}))||[],features:{bedrooms:r,bathrooms:o,area:s,floor:i},location:e.title||e.name||t.address||t.direccion||"Madrid",metadata:t,createdAt:e.date_created||new Date().toISOString(),updatedAt:e.date_modified||new Date().toISOString()}}catch(e){return console.error("‚ùå Error transformando propiedad real:",e.message),null}},l=async e=>{console.log(`üè† Cargando propiedad REAL con ID: ${e}`);let t=d.endpoints[0],a={name:"standard",headers:{"User-Agent":"Goza Madrid Real Estate/1.0",Accept:"application/json"}};for(let r=0;r<d.connection.maxRetries;r++)try{console.log(`üîÑ Intento ${r+1}: ${t} con estrategia ${a.name} para ID ${e}`);let n=await o.default.get(`${t}/products/${e}`,{params:{consumer_key:d.credentials.key,consumer_secret:d.credentials.secret},timeout:d.connection.timeout,headers:a.headers});if(200===n.status&&n.data){let r=c(n.data);if(r)return console.log(`‚úÖ \xa1\xc9XITO! Propiedad REAL ${e} cargada desde ${t} (${a.name})`),r}}catch(o){console.log(`‚ùå ${t} + ${a.name} (intento ${r+1}) para ID ${e}: ${o.message}`),r<d.connection.maxRetries-1&&await new Promise(e=>setTimeout(e,d.connection.retryDelay))}throw Error(`No se pudo cargar la propiedad real con ID ${e}`)};async function i(e,t){let a=Date.now(),{id:r}=e.query;if(!r)return t.status(400).json({error:"ID requerido",message:"Se requiere un ID de propiedad v\xe1lido"});console.log(`üè† API PROPIEDAD INDIVIDUAL iniciada - ID: ${r}`),console.log(`üîë Credenciales configuradas: ${d.credentials.key?"S\xcd":"NO"}`),t.setHeader("Cache-Control","s-maxage=600, stale-while-revalidate=300"),t.setHeader("Content-Type","application/json");try{let e=await l(r),o=Date.now()-a;return console.log(`üéâ \xc9XITO: Propiedad REAL ${r} cargada en ${o}ms`),t.status(200).json(e)}catch(o){let e=Date.now()-a;if(console.error(`üí• ERROR: No se pudo cargar la propiedad real ${r} despu\xe9s de ${e}ms:`,o.message),o.message.includes("404")||o.message.includes("not found"))return t.status(404).json({error:"Propiedad no encontrada",message:`La propiedad con ID ${r} no existe en el inventario`,timestamp:new Date().toISOString(),duration:`${e}ms`});return t.status(503).json({error:"Propiedad no disponible",message:`No se pudo cargar la propiedad ${r} del inventario. Int\xe9ntelo de nuevo en unos minutos.`,timestamp:new Date().toISOString(),duration:`${e}ms`})}}r()}catch(e){r(e)}})},69368:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>l,default:()=>c,routeModule:()=>p});var o=a(33480),n=a(8667),s=a(86435),i=a(44467),d=e([i]);i=(d.then?(await d)():d)[0];let c=(0,s.M)(i,"default"),l=(0,s.M)(i,"config"),p=new o.PagesAPIRouteModule({definition:{kind:n.A.PAGES_API,page:"/api/properties/sources/woocommerce/[id]",pathname:"/api/properties/sources/woocommerce/[id]",bundlePath:"",filename:""},userland:i});r()}catch(e){r(e)}})},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},86435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},94911:(e,t,a)=>{a.d(t,{hM:()=>r});let r=e=>{let t;return e&&"Consultar"!==e?isNaN(t="string"==typeof e?parseFloat(e.replace(/[^\d.-]/g,"")):e)||t<=0?0:(t<1e4&&t>=50&&(t*=1e3),t<5e4&&t>=10&&("string"==typeof e?parseFloat(e.replace(/[^\d.-]/g,"")):e)<100&&(t*=1e3),t):0}}};var t=require("../../../../../webpack-api-runtime.js");t.C(e);var a=t(t.s=69368);module.exports=a})();