"use strict";(()=>{var e={};e.id=5890,e.ids=[5890],e.modules={1428:e=>{e.exports=import("axios")},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return o}});var o=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},29047:(e,r,o)=>{o.a(e,async(e,t)=>{try{o.r(r),o.d(r,{config:()=>d,default:()=>i,routeModule:()=>p});var a=o(33480),n=o(8667),s=o(86435),c=o(47746),l=e([c]);c=(l.then?(await l)():l)[0];let i=(0,s.M)(c,"default"),d=(0,s.M)(c,"config"),p=new a.PagesAPIRouteModule({definition:{kind:n.A.PAGES_API,page:"/api/properties/sources/woocommerce",pathname:"/api/properties/sources/woocommerce",bundlePath:"",filename:""},userland:c});t()}catch(e){t(e)}})},33480:(e,r,o)=>{e.exports=o(75600)},47746:(e,r,o)=>{o.a(e,async(e,t)=>{try{o.r(r),o.d(r,{default:()=>i,loadRealProperties:()=>p});var a=o(1428),n=o(86391),s=e([a,n]);[a,n]=s.then?(await s)():s;let d={endpoints:[process.env.WC_API_URL||"https://wordpress.realestategozamadrid.com/wp-json/wc/v3"],credentials:{key:process.env.WC_CONSUMER_KEY,secret:process.env.WC_CONSUMER_SECRET},connection:{timeout:8e3,maxRetries:1,retryDelay:500}};async function c(e){try{let r=await n.kv.get(e);if(r)return console.log(`ðŸš€ Vercel KV Cache HIT para la clave: ${e}`),r}catch(r){console.error(`âŒ Error leyendo de Vercel KV para ${e}:`,r.message)}return console.log(`ðŸ’¨ Vercel KV Cache MISS para la clave: ${e}`),null}async function l(e,r){try{await n.kv.set(e,r,{ex:1800}),console.log(`âœ… Datos cacheados en Vercel KV para la clave: ${e} con TTL: 1800s`)}catch(r){console.error(`âŒ Error escribiendo en Vercel KV para ${e}:`,r.message)}}let p=async(e=1,r=5)=>{let o=`woo_props_page_${e}_limit_${r}`;console.log(`ðŸ  Cargando propiedades SOLO desde cach\xe9 - P\xe1gina: ${e}, L\xedmite: ${r}`);let t=await c(o);if(t)return console.log(`âœ… Cache HIT espec\xedfico: ${t.length} propiedades`),t;let a=await c("woo_props_all");if(a&&Array.isArray(a)){let t=(e-1)*r,n=a.slice(t,t+r);return console.log(`âœ… Cache HIT general: ${n.length} propiedades (de ${a.length} totales)`),n.length>0&&l(o,n).catch(e=>console.error("âš ï¸ Error guardando cach\xe9 espec\xedfico:",e.message)),n}return console.log(`ðŸ’¨ Sin datos en cach\xe9. El cron job precargar\xe1 los datos pronto.`),[]};async function i(e,r){let o=Date.now(),{limit:t=5,page:a=1}=e.query;if(console.log(`ðŸ  API Handler con Vercel KV iniciada - P\xe1gina: ${a}, L\xedmite: ${t}`),!d.credentials.key||!d.credentials.secret)return console.warn("âš ï¸ Sin credenciales WooCommerce"),r.setHeader("X-WooCommerce-Status","no-credentials"),r.status(200).json([]);let n=!!(process.env.KV_REST_API_URL&&process.env.KV_REST_API_TOKEN);console.log(`ðŸ”‘ Vercel KV disponible: ${n}`),r.setHeader("Cache-Control","s-maxage=60, stale-while-revalidate=300"),r.setHeader("Content-Type","application/json");try{let e=await p(parseInt(a),parseInt(t)),n=Date.now()-o;return console.log(`ðŸŽ‰ \xc9XITO: ${e.length} propiedades en ${n}ms`),r.setHeader("X-WooCommerce-Status","success"),r.setHeader("X-Response-Time",`${n}ms`),r.setHeader("X-Cache-Type","vercel-kv"),r.status(200).json(e)}catch(t){let e=Date.now()-o;return console.error(`ðŸ’¥ ERROR: ${t.message} en ${e}ms`),r.setHeader("X-WooCommerce-Status","error"),r.setHeader("X-Response-Time",`${e}ms`),r.status(200).json([])}}t()}catch(e){t(e)}})},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},86391:e=>{e.exports=import("@vercel/kv")},86435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,o){return o in r?r[o]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,o)):"function"==typeof r&&"default"===o?r:void 0}}})}};var r=require("../../../../webpack-api-runtime.js");r.C(e);var o=r(r.s=29047);module.exports=o})();