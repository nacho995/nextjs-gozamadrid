"use strict";(()=>{var e={};e.id=5277,e.ids=[5277],e.modules={8667:(e,o)=>{Object.defineProperty(o,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},33480:(e,o,r)=>{e.exports=r(75600)},46301:(e,o,r)=>{r.r(o),r.d(o,{config:()=>m,default:()=>p,routeModule:()=>u});var t={};r.r(t),r.d(t,{default:()=>d});var a=r(33480),i=r(8667),n=r(86435);let s=["https://images.weserv.nl/","https://images.wsrv.nl/"],l=["https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&h=600&fit=crop&q=80","https://images.unsplash.com/photo-1449824913935-59a10b8d2000?w=800&h=600&fit=crop&q=80","https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=800&h=600&fit=crop&q=80"];async function c(e,o=800,r=600){for(let t=0;t<s.length;t++){let a=s[t];try{let i=`${a}?url=${encodeURIComponent(e)}&w=${o}&h=${r}&fit=cover&default=${encodeURIComponent(l[0])}`;if(console.log(`[proxy-image] Probando servicio ${t+1}: ${a}`),(await fetch(i,{method:"HEAD",signal:AbortSignal.timeout(5e3)})).ok)return console.log(`[proxy-image] Servicio ${t+1} disponible`),i}catch(e){console.log(`[proxy-image] Servicio ${t+1} fall\xf3:`,e.message);continue}}return console.log("[proxy-image] Todos los servicios fallaron, usando fallback"),l[0]}async function d(e,o){var r;if("GET"!==e.method)return o.status(405).json({error:"M\xe9todo no permitido"});let{url:t,w:a=800,h:i=600}=e.query;if(!t)return console.log("[proxy-image] No se proporcion\xf3 URL, redirigiendo a fallback"),o.redirect(307,l[0]);let n=(r=t)&&"string"==typeof r?r.includes("via.placeholder.com")||r.includes("placeholder.com")||r.includes("example.com")?(console.log("[proxy-image] URL problem\xe1tica detectada:",r),null):(r.includes("wordpress.realestategozamadrid.com")&&console.log("[proxy-image] Corrigiendo URL de WordPress:",r=r.replace("wordpress.realestategozamadrid.com","www.realestategozamadrid.com")),r.startsWith("http:")&&(r=r.replace("http:","https:")),r):null;if(!n)return console.log("[proxy-image] URL inv\xe1lida o problem\xe1tica:",t),o.redirect(307,l[0]);try{new URL(n)}catch(e){return console.error("[proxy-image] URL malformada:",n),o.redirect(307,l[0])}try{if(n.includes("unsplash.com")||n.includes("images.unsplash.com"))return console.log("[proxy-image] Imagen de Unsplash, sirviendo directamente"),o.redirect(307,n);if(n.includes("realestategozamadrid.com")&&n.includes("wp-content"))try{if(console.log("[proxy-image] Probando acceso directo a WordPress:",n),(await fetch(n,{method:"HEAD",signal:AbortSignal.timeout(3e3)})).ok)return console.log("[proxy-image] Acceso directo exitoso, redirigiendo"),o.redirect(307,n)}catch(e){console.log("[proxy-image] Acceso directo fall\xf3, usando proxy:",e.message)}let e=await c(n,a,i);return o.setHeader("Cache-Control","public, max-age=86400"),o.setHeader("X-Proxy-Used","true"),o.setHeader("X-Original-URL",n),console.log("[proxy-image] Redirigiendo a:",e),o.redirect(307,e)}catch(e){return console.error("[proxy-image] Error general:",e),o.setHeader("X-Proxy-Error",e.message),o.redirect(307,l[Math.floor(Math.random()*l.length)])}}let p=(0,n.M)(t,"default"),m=(0,n.M)(t,"config"),u=new a.PagesAPIRouteModule({definition:{kind:i.A.PAGES_API,page:"/api/proxy-image",pathname:"/api/proxy-image",bundlePath:"",filename:""},userland:t})},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},86435:(e,o)=>{Object.defineProperty(o,"M",{enumerable:!0,get:function(){return function e(o,r){return r in o?o[r]:"then"in o&&"function"==typeof o.then?o.then(o=>e(o,r)):"function"==typeof o&&"default"===r?o:void 0}}})}};var o=require("../../webpack-api-runtime.js");o.C(e);var r=o(o.s=46301);module.exports=r})();