"use strict";(()=>{var e={};e.id=7255,e.ids=[7255],e.modules={8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return o}});var o=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},15474:(e,r,o)=>{o.r(r),o.d(r,{config:()=>u,default:()=>l,routeModule:()=>p});var t={};o.r(t),o.d(t,{default:()=>d});var s=o(33480),c=o(8667),a=o(86435),n=o(94749),i=o(61773);async function d(e,r){if(r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),r.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization, Cache-Control, Accept, X-Requested-With, Origin, X-Api-Key"),r.setHeader("Access-Control-Max-Age","86400"),"OPTIONS"===e.method)return r.status(200).end();try{let o,{slug:t=[],source:s}=e.query;if(s){let{path:o}=e.query,t="";switch(s.toLowerCase()){case"mongodb":t=`http://api.realestategozamadrid.com/api${o?`/${o.replace(/^\//,"")}`:""}`;break;case"woocommerce":if(!i.A||!i.A.WC_API_URL)return console.error("[Proxy] Error: Configuraci\xf3n de WooCommerce no disponible"),r.status(500).json({error:"Error de configuraci\xf3n",message:"Configuraci\xf3n de WooCommerce no disponible"});if(t=`${i.A.WC_API_URL}${o?`/${o.replace(/^\//,"")}`:""}`,i.A.WOO_COMMERCE_KEY&&i.A.WOO_COMMERCE_SECRET){let e=t.includes("?")?"&":"?";t+=`${e}consumer_key=${i.A.WOO_COMMERCE_KEY}&consumer_secret=${i.A.WOO_COMMERCE_SECRET}`}else console.warn("[Proxy] Advertencia: Credenciales de WooCommerce no disponibles");break;case"wordpress":if(!n.A||!n.A.WP_API_URL)return console.error("[Proxy] Error: Configuraci\xf3n de WordPress no disponible"),r.status(500).json({error:"Error de configuraci\xf3n",message:"Configuraci\xf3n de WordPress no disponible"});t=`${n.A.WP_API_URL}${o?`/${o.replace(/^\//,"")}`:""}`;break;default:return r.status(400).json({error:"Fuente no v\xe1lida",message:"La fuente debe ser: mongodb, woocommerce o wordpress",validSources:["mongodb","woocommerce","wordpress"]})}if(!t)return r.status(500).json({error:"Error de configuraci\xf3n",message:"No se pudo construir la URL de destino"});let c=new URLSearchParams;Object.keys(e.query).forEach(r=>{"source"!==r&&"path"!==r&&"slug"!==r&&c.append(r,e.query[r])}),c.toString()&&(t+=(t.includes("?")?"&":"?")+c.toString()),console.log(`[Proxy] Redirigiendo a: ${t}`);let a={method:e.method,headers:{"Content-Type":"application/json",Accept:"application/json","User-Agent":"GozaMadrid/1.0"},body:"GET"!==e.method&&"HEAD"!==e.method?JSON.stringify(e.body):void 0},d=new AbortController,l=setTimeout(()=>d.abort(),15e3);a.signal=d.signal;try{let e,o=await fetch(t,a);clearTimeout(l),o.ok||console.error(`[Proxy] Error en la respuesta: ${o.status} ${o.statusText}`);let s=o.headers.get("content-type");if(s&&s.includes("application/json"))try{e=await o.json()}catch(e){return console.error("[Proxy] Error al parsear JSON:",e),r.status(o.status).send("Error al procesar la respuesta como JSON")}else try{let e=await o.text();return r.status(o.status).send(e)}catch(e){return console.error("[Proxy] Error al obtener texto de respuesta:",e),r.status(o.status).send("Error al procesar la respuesta como texto")}return r.status(o.status).json(e)}catch(e){if(clearTimeout(l),"AbortError"===e.name)return r.status(504).json({error:"Timeout",message:"La solicitud no pudo completarse en el tiempo establecido",source:s});return console.error("[Proxy] Error en fetch:",e),r.status(500).json({error:"Error al realizar la solicitud",message:e.message})}}let c=t[0],a=t.slice(1).join("/")||"";if(!c)return r.status(400).json({error:"Se requiere especificar el servicio en la URL"});let d={"Content-Type":"application/json",Accept:"application/json","User-Agent":"GozaMadrid/1.0"},l=i.A.WOO_COMMERCE_KEY,u=i.A.WOO_COMMERCE_SECRET,p=i.A.WC_API_URL;if(console.log("[Proxy] Estado de credenciales:",{service:c,hasWooCommerceKey:!!l,hasWooCommerceSecret:!!u,keyLength:l?.length,secretLength:u?.length,wcApiUrl:p,wpApiUrl:n.A.WP_API_URL}),("woocommerce"===c||"woocommerce-product"===c)&&!i.A.hasCredentials())return console.error("[Proxy] Error: Faltan credenciales de WooCommerce"),r.status(500).json({error:"Error de configuraci\xf3n del servidor",details:"Faltan credenciales de WooCommerce",service:"woocommerce"});switch(c){case"wordpress":o=`${n.A.WP_API_URL}${a?`/${a}`:""}`;break;case"woocommerce":let m=(o=`${p}${a?`/${a}`:""}`).includes("?")?"&":"?";o+=`${m}consumer_key=${l}&consumer_secret=${u}`;break;case"woocommerce-product":let E=t[1]||e.query.id;if(!E)return r.status(400).json({error:"Falta el ID del producto",message:"Se requiere el ID del producto en la URL o como par\xe1metro id"});console.log(`[Proxy] Solicitando producto WooCommerce con ID: ${E}`),o=i.A.getProductUrl(E),console.log(`[Proxy] URL generada para producto: ${o.replace(/consumer_key=([^&]+)/,"consumer_key=HIDDEN").replace(/consumer_secret=([^&]+)/,"consumer_secret=HIDDEN")}`);break;case"backend":o=`${n.A.BACKEND_API_URL}${a?`/${a}`:""}`;break;default:return r.status(400).json({error:"Servicio no v\xe1lido",message:"Los servicios v\xe1lidos son: wordpress, woocommerce, woocommerce-product, backend"})}if(!o||!o.startsWith("http"))return console.error("[Proxy] URL de destino inv\xe1lida:",{service:c,endpoint:a,targetUrl:o||"undefined",config:{WP_API_URL:n.A.WP_API_URL||"no definido",WC_API_URL:n.A.WC_API_URL||"no definido",BACKEND_API_URL:n.A.BACKEND_API_URL||"no definido"}}),r.status(500).json({error:"URL de destino inv\xe1lida",message:"La configuraci\xf3n del servidor no tiene una URL v\xe1lida para este servicio",service:c});let g=new URLSearchParams;Object.keys(e.query).forEach(r=>{"slug"!==r&&"id"!==r&&("woocommerce-product"!==c||"id"!==r)&&g.append(r,e.query[r])}),g.toString()&&(o+=(o.includes("?")?"&":"?")+g.toString());let C=o.replace(/consumer_key=([^&]+)/,"consumer_key=HIDDEN").replace(/consumer_secret=([^&]+)/,"consumer_secret=HIDDEN");console.log("[Proxy] Request:",{service:c,endpoint:a,targetUrl:C,method:e.method,headers:Object.keys(d),query:e.query,slug:t});let _=await fetch(o,{method:e.method,headers:d,body:"GET"!==e.method&&"HEAD"!==e.method?JSON.stringify(e.body):void 0});if(console.log("[Proxy] Response:",{status:_.status,statusText:_.statusText,headers:Object.fromEntries(_.headers.entries()),url:C}),!_.ok){let o=await _.text();if(console.error("[Proxy] Error response:",{status:_.status,statusText:_.statusText,service:c,endpoint:a,url:C,body:o.substring(0,500)}),"woocommerce-product"===c&&404===_.status){console.log(`[Proxy] Error 404 para producto ID ${t[1]||e.query.id} en WooCommerce`);try{let o=`${p}/products?consumer_key=${l}&consumer_secret=${u}&per_page=5`;console.log("[Proxy] Obteniendo productos alternativos");let s=await fetch(o,{headers:d,method:"GET"});if(s.ok){let o=await s.json();return console.log(`[Proxy] Se encontraron ${o.length} productos alternativos`),r.status(404).json({error:"Producto no encontrado",message:`La propiedad con ID ${t[1]||e.query.id} no existe o ya no est\xe1 disponible.`,suggestions:o.slice(0,5).map(e=>({id:e.id,name:e.name,price:e.price,images:e.images&&e.images.length>0?[e.images[0].src]:[]})),source:"woocommerce",debug:{requestedId:t[1]||e.query.id,requestUrl:C.split("?")[0],service:c,status:_.status}})}}catch(e){console.error("[Proxy] Error al obtener alternativas:",e.message)}}return r.status(_.status).json({error:"Error en la respuesta del servidor",status:_.status,message:o,service:c,endpoint:a,url:C.split("?")[0]})}let P=await _.json();return console.log("[Proxy] Success:",{service:c,endpoint:a,dataType:typeof P,isArray:Array.isArray(P),length:Array.isArray(P)?P.length:null,sample:Array.isArray(P)&&P.length>0?{id:P[0].id,type:P[0].type}:null}),r.status(_.status).json(P)}catch(e){return console.error("[Proxy] Error:",e),r.status(500).json({error:"Error interno del servidor",message:e.message||"Se produjo un error al procesar la solicitud",stack:void 0})}}let l=(0,a.M)(t,"default"),u=(0,a.M)(t,"config"),p=new s.PagesAPIRouteModule({definition:{kind:c.A.PAGES_API,page:"/api/proxy/[[...slug]]",pathname:"/api/proxy/[[...slug]]",bundlePath:"",filename:""},userland:t})},33480:(e,r,o)=>{e.exports=o(75600)},61773:(e,r,o)=>{o.d(r,{A:()=>u});let t="1"===process.env.VERCEL,s=process.env.NEXT_PUBLIC_WC_API_URL||"https://wordpress.realestategozamadrid.com/wp-json/wc/v3",c=process.env.NEXT_PUBLIC_WOO_COMMERCE_KEY,a=process.env.NEXT_PUBLIC_WOO_COMMERCE_SECRET;console.log(`[WooConfig] Configuraci\xf3n cargada:`,{entorno:"production",isVercel:t,hasKey:!!c,hasSecret:!!a,apiUrl:s});let n={PRODUCTS:"/products",PRODUCT:e=>`/products/${e}`,CATEGORIES:"/products/categories",CATEGORY:e=>`/products/categories/${e}`},i={headers:{Accept:"application/json","Content-Type":"application/json"}},d=(e,r={})=>{try{let o=new URL(`${s}${e}`);return c&&a?(o.searchParams.append("consumer_key",c),o.searchParams.append("consumer_secret",a)):console.warn("[WooConfig] Advertencia: Construyendo URL sin credenciales de WooCommerce"),Object.entries(r).forEach(([e,r])=>{o.searchParams.append(e,r)}),o.toString()}catch(r){return console.error("[WooConfig] Error construyendo URL:",r.message),`${s}${e}?consumer_key=${c}&consumer_secret=${a}`}},l=(e,r)=>"string"!=typeof e?(console.warn("[WooConfig] Intento de split en un valor no string:",e),[]):e.split(r),u={WC_API_URL:s,WOO_COMMERCE_KEY:c,WOO_COMMERCE_SECRET:a,ENDPOINTS:n,isVercel:t,isDevelopment:!1,hasCredentials:()=>!!(c&&a),getProductUrl:(e,r={})=>d(n.PRODUCT(e),r),getProductsUrl:(e={})=>d(n.PRODUCTS,e),getAuth:()=>({key:c,secret:a}),getFetchConfig:(e={})=>({...i,...e}),getDirectProductUrl:e=>`${s}/products/${e}?consumer_key=${c}&consumer_secret=${a}`,getDirectProductsUrl:()=>`${s}/products?consumer_key=${c}&consumer_secret=${a}`,safeSplit:l,getWooCommerceApiUrl:()=>"string"!=typeof s?(console.warn("[WooConfig] WC_API_URL no es una cadena v\xe1lida:",s),"https://wordpress.realestategozamadrid.com/wp-json/wc/v3"):l(s,"?")[0]||"https://wordpress.realestategozamadrid.com/wp-json/wc/v3"}},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},86435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,o){return o in r?r[o]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,o)):"function"==typeof r&&"default"===o?r:void 0}}})},94749:(e,r,o)=>{o.d(r,{A:()=>i});let t="https://www.realestategozamadrid.com",s="https://wordpress.realestategozamadrid.com/wp-json/wp/v2",c="https://wordpress.realestategozamadrid.com/wp-json/wc/v3",a={headers:{Accept:"application/json","Content-Type":"application/json"}},n={SITE_URL:t,WP_API_URL:s,WC_API_URL:c,defaultFetchConfig:a,WOO_COMMERCE_KEY:process.env.NEXT_PUBLIC_WOO_COMMERCE_KEY||"ck_d4c3f5c3c5c3c5c3c5c3c5c3c5c3c5c3c5c3c5c3",WOO_COMMERCE_SECRET:process.env.NEXT_PUBLIC_WOO_COMMERCE_SECRET||"cs_c5c3c5c3c5c3c5c3c5c3c5c3c5c3c5c3c5c3c5c3",ITEMS_PER_PAGE:12,API_PROXY:{MONGODB:"api/properties/sources/mongodb",PROPERTIES:"api/properties",WOOCOMMERCE:"api/woocommerce/products"},ENDPOINTS:{PROPERTIES:"api/properties",PROPERTY:"api/properties",CONTACT:"api/contact",CONFIG:"api/config/properties",WOOCOMMERCE:{PRODUCTS:"api/woocommerce/products",PRODUCT:e=>`api/woocommerce/products/${e}`}},getBaseUrl:()=>t,getEndpointUrl:e=>{let r=e.startsWith("/")?e.slice(1):e;return`${t}/${r}`},getMongoUrl:(e=null)=>{let r="api/properties/sources/mongodb";return e?`${r}/${e}`:r},getWooCommerceUrl:(e=null)=>{let r="api/woocommerce/products";return e?`${r}/${e}`:r},getWordPressBaseUrl:()=>`${t}/api/proxy/wordpress`,getWooCommerceAuth:()=>({key:n.WOO_COMMERCE_KEY,secret:n.WOO_COMMERCE_SECRET}),getFetchConfig:(e={})=>({...a,...e})};process.env.NEXT_PUBLIC_WOO_COMMERCE_KEY,process.env.NEXT_PUBLIC_WOO_COMMERCE_SECRET;let i=n}};var r=require("../../../webpack-api-runtime.js");r.C(e);var o=r(r.s=15474);module.exports=o})();