"use strict";(()=>{var e={};e.id=8518,e.ids=[8518],e.modules={8667:(e,o)=>{Object.defineProperty(o,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},33480:(e,o,t)=>{e.exports=t(75600)},49196:(e,o,t)=>{t.r(o),t.d(o,{config:()=>d,default:()=>i,routeModule:()=>u});var r={};t.r(r),t.d(r,{default:()=>a});var n=t(33480),c=t(8667),s=t(86435);async function a(e,o){if(o.setHeader("Access-Control-Allow-Origin","*"),o.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS"),o.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization, Cache-Control, Accept"),"OPTIONS"===e.method)return o.status(200).end();if("GET"!==e.method)return o.status(405).json({error:"M\xe9todo no permitido"});try{let t=process.env.WC_CONSUMER_KEY,r=process.env.WC_CONSUMER_SECRET,n="https://wordpress.realestategozamadrid.com/wp-json/wc/v3",{id:c}=e.query,s=c;if("string"==typeof e.url&&e.url.includes("/woocommerce-product/")){let o=e.url.match(/\/woocommerce-product\/([^\/\?]+)/);o&&o[1]&&(s=o[1])}if(console.log(`[WooCommerce Product] ID procesado: ${s}`),!s){let e=`${n}/products?consumer_key=${t}&consumer_secret=${r}&per_page=20`;console.log("[WooCommerce Product] Obteniendo lista de productos");let c=await fetch(e,{headers:{Accept:"application/json","Content-Type":"application/json","User-Agent":"GozaMadrid/1.0"},timeout:2e4});if(!c.ok)throw Error(`Error al obtener lista de productos: ${c.status}`);let s=await c.json();return console.log(`[WooCommerce Product] Se encontraron ${s.length} productos`),o.status(200).json({products:s.map(e=>({id:e.id,name:e.name,price:e.price,images:e.images&&e.images.length>0?[e.images[0].src]:[]})),count:s.length})}let a=`${n}/products/${s}?consumer_key=${t}&consumer_secret=${r}`;console.log(`[WooCommerce Product] Solicitando producto con ID: ${s}`),console.log(`[WooCommerce Product] URL: ${a.replace(/consumer_key=([^&]+)/,"consumer_key=HIDDEN").replace(/consumer_secret=([^&]+)/,"consumer_secret=HIDDEN")}`);let i=`${n}/products?include=${s}&consumer_key=${t}&consumer_secret=${r}`;console.log(`[WooCommerce Product] Verificando existencia del producto con ID: ${s}`);let d=await fetch(i,{headers:{Accept:"application/json","Content-Type":"application/json","User-Agent":"GozaMadrid/1.0"},timeout:2e4});if(d.ok){let e=await d.json();if(console.log(`[WooCommerce Product] Resultado de verificaci\xf3n: ${JSON.stringify({responseOk:d.ok,status:d.status,resultLength:e.length,hasProduct:e.length>0})}`),!e||0===e.length){console.log(`[WooCommerce Product] Producto ${s} no encontrado en la verificaci\xf3n`);let e=`${n}/products?consumer_key=${t}&consumer_secret=${r}&per_page=5&status=publish`,c=await fetch(e,{headers:{Accept:"application/json","Content-Type":"application/json","User-Agent":"GozaMadrid/1.0"},timeout:15e3});if(c.ok){let e=await c.json();return console.log(`[WooCommerce Product] Encontradas ${e.length} alternativas`),o.status(404).json({error:`Producto con ID ${s} no encontrado`,message:`La propiedad con ID ${s} no existe o ya no est\xe1 disponible.`,productId:s,productIdRequested:s,suggestions:e.map(e=>({id:e.id,name:e.name,price:e.price,images:e.images&&e.images.length>0?[e.images[0].src]:[]})),source:"woocommerce"})}return o.status(404).json({error:`Producto con ID ${s} no encontrado`,message:`La propiedad con ID ${s} no existe o ya no est\xe1 disponible.`,productId:s,source:"woocommerce"})}if(e.length>0){let t=e[0];return console.log(`[WooCommerce Product] Producto encontrado en verificaci\xf3n: ${t.name}`),t.source="woocommerce",o.status(200).json(t)}}console.log("[WooCommerce Product] Buscando en lista completa");let u=`${n}/products?consumer_key=${t}&consumer_secret=${r}&per_page=100`,l=await fetch(u,{headers:{Accept:"application/json","Content-Type":"application/json","User-Agent":"GozaMadrid/1.0"},timeout:2e4});if(l.ok){let e=await l.json();console.log(`[WooCommerce Product] Lista completa: ${e.length} productos`);let t=e.find(e=>e.id.toString()===s.toString());if(t)return console.log(`[WooCommerce Product] Producto encontrado en listado: ${t.name}`),t.source="woocommerce",o.status(200).json(t);console.log("[WooCommerce Product] Producto no encontrado en listado, intentando obtener directamente")}let m=await fetch(a,{headers:{Accept:"application/json","Content-Type":"application/json","User-Agent":"GozaMadrid/1.0"},timeout:2e4});if(!m.ok){console.error(`[WooCommerce Product] Error ${m.status}: Producto no encontrado`);let e="";try{e=await m.text(),console.log(`[WooCommerce Product] Respuesta de error: ${e.substring(0,200)}`)}catch(e){console.error(`[WooCommerce Product] No se pudo leer el texto de error: ${e.message}`)}let c=`${n}/products?consumer_key=${t}&consumer_secret=${r}&per_page=5`,a=await fetch(c);if(a.ok){let t=await a.json();return o.status(404).json({error:`Producto con ID ${s} no encontrado`,message:`La propiedad con ID ${s} no existe o ya no est\xe1 disponible.`,errorDetails:e?e.substring(0,200):void 0,suggestions:t.map(e=>({id:e.id,name:e.name,price:e.price,images:e.images&&e.images.length>0?[e.images[0].src]:[]})),source:"woocommerce"})}return o.status(404).json({error:`Producto con ID ${s} no encontrado`,message:`La propiedad con ID ${s} no existe o ya no est\xe1 disponible.`,errorDetails:e?e.substring(0,200):void 0,source:"woocommerce"})}let p=await m.json();return console.log(`[WooCommerce Product] Producto obtenido: ${p.name}`),p.source="woocommerce",o.status(200).json(p)}catch(e){return console.error("[WooCommerce Product] Error:",e.message),console.error("[WooCommerce Product] Stack:",e.stack),o.status(500).json({error:`Error al obtener datos de WooCommerce: ${e.message}`,fallbackMode:!0,source:"woocommerce",debug:void 0})}}let i=(0,s.M)(r,"default"),d=(0,s.M)(r,"config"),u=new n.PagesAPIRouteModule({definition:{kind:c.A.PAGES_API,page:"/api/proxy/woocommerce-product",pathname:"/api/proxy/woocommerce-product",bundlePath:"",filename:""},userland:r})},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},86435:(e,o)=>{Object.defineProperty(o,"M",{enumerable:!0,get:function(){return function e(o,t){return t in o?o[t]:"then"in o&&"function"==typeof o.then?o.then(o=>e(o,t)):"function"==typeof o&&"default"===t?o:void 0}}})}};var o=require("../../../webpack-api-runtime.js");o.C(e);var t=o(o.s=49196);module.exports=t})();