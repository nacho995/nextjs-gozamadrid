<!DOCTYPE html>
<html>
<head>
  <title>Test API - Propiedades</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      line-height: 1.6;
    }
    h1 {
      color: #333;
    }
    #result {
      margin: 20px 0;
      padding: 15px;
      background-color: #f5f5f5;
      border-radius: 5px;
    }
    #properties {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }
    .property-card {
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .property-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 5px;
    }
    .property-card h3 {
      margin: 10px 0;
    }
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(0,0,0,0.3);
      border-radius: 50%;
      border-top-color: #333;
      animation: spin 1s ease-in-out infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .error {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Test de conexi贸n a API - Propiedades</h1>
  <div>
    <button id="load-wc">Cargar propiedades de WooCommerce</button>
    <button id="inspect-wc">Inspeccionar estructura</button>
  </div>
  <div id="result">Esperando acci贸n...</div>
  <div id="properties"></div>

  <script>
    document.getElementById('load-wc').addEventListener('click', () => {
      const resultDiv = document.getElementById('result');
      const propertiesDiv = document.getElementById('properties');
      
      resultDiv.innerHTML = '<div class="loading"></div> Cargando propiedades de WooCommerce...';
      propertiesDiv.innerHTML = '';
      
      fetch("/api/proxy?service=woocommerce&resource=products&per_page=10")
        .then(response => {
          if (!response.ok) {
            throw new Error(`Error de red: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          resultDiv.textContent = `Conexi贸n exitosa: ${data.length} propiedades encontradas`;
          
          data.forEach(property => {
            const card = document.createElement('div');
            card.className = 'property-card';
            
            // Intentar obtener la imagen
            let imageUrl = '/img/default-property-image.jpg';
            if (property.images && property.images.length > 0) {
              imageUrl = property.images[0].src;
            }
            
            card.innerHTML = `
              <img src="${imageUrl}" alt="${property.name}">
              <h3>${property.name}</h3>
              <p>ID: ${property.id}</p>
              <p>Precio: ${property.price || 'No disponible'}</p>
            `;
            
            propertiesDiv.appendChild(card);
          });
        })
        .catch(error => {
          resultDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
          console.error("Error:", error);
        });
    });
    
    document.getElementById('inspect-wc').addEventListener('click', () => {
      const resultDiv = document.getElementById('result');
      
      resultDiv.innerHTML = '<div class="loading"></div> Inspeccionando estructura de datos...';
      
      fetch("/api/proxy?service=woocommerce&resource=products&per_page=1")
        .then(response => {
          if (!response.ok) {
            throw new Error(`Error de red: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          if (data.length === 0) {
            resultDiv.textContent = 'No se encontraron propiedades';
            return;
          }
          
          // Crear una representaci贸n formateada de la estructura
          const property = data[0];
          const structure = JSON.stringify(property, null, 2);
          
          resultDiv.innerHTML = `
            <h3>Estructura de datos de WooCommerce (ID: ${property.id})</h3>
            <pre>${structure}</pre>
          `;
        })
        .catch(error => {
          resultDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
          console.error("Error:", error);
        });
    });
  </script>
</body>
</html>
