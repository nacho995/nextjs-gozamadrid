(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1040],{89546:(e,o,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/diagnostico",function(){return a(93421)}])},93421:(e,o,a)=>{"use strict";a.r(o),a.d(o,{default:()=>i});var s=a(37876),r=a(14232),t=a(54710),n=a.n(t),c=a(4121),d=a(55605);function i(){let{id:e}=(0,d.useRouter)().query,[o,a]=(0,r.useState)(""),[t,i]=(0,r.useState)(!1),[l,m]=(0,r.useState)(null),[p,h]=(0,r.useState)(null),[x,u]=(0,r.useState)([]);(0,r.useEffect)(()=>{e&&(a(e),g(null,e))},[e]);let b=e=>{u(o=>[...o,{time:new Date().toISOString(),message:e}])},g=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e&&e.preventDefault();let s=a||o;if(!s){h("Por favor, introduce un ID de propiedad");return}i(!0),m(null),h(null),u([]),b("Iniciando diagn\xf3stico para ID: ".concat(s));try{let e;let o=/^[0-9a-fA-F]{24}$/.test(s);b("\xbfEs ID de MongoDB? ".concat(o));let a=new AbortController,r=setTimeout(()=>{b("TIMEOUT alcanzado para la propiedad con ID: ".concat(s)),a.abort()},15e3);if(b("Intentando cargar propiedad con ID: ".concat(s)),o){b("Obteniendo propiedad de MongoDB con ID ".concat(s));try{let o="/property/".concat(s);b("URL de petici\xf3n MongoDB: ".concat(o)),e=await fetch(o,{signal:a.signal,headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}}),b("Respuesta MongoDB recibida: ".concat(e.status," ").concat(e.statusText))}catch(e){if(clearTimeout(r),b("Error en fetch MongoDB: ".concat(e.message)),"AbortError"===e.name)throw Error("Tiempo de espera agotado al obtener la propiedad. Por favor, int\xe9ntalo de nuevo.");throw e}}else{b("Obteniendo propiedad de WooCommerce con ID ".concat(s));try{let o="/api/wordpress-proxy?path=products/".concat(s);b("URL de petici\xf3n WooCommerce: ".concat(o)),e=await fetch(o,{signal:a.signal,headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}}),b("Respuesta WooCommerce recibida: ".concat(e.status," ").concat(e.statusText))}catch(e){if(clearTimeout(r),b("Error en fetch WooCommerce: ".concat(e.message)),"AbortError"===e.name)throw Error("Tiempo de espera agotado al obtener la propiedad. Por favor, int\xe9ntalo de nuevo.");throw e}}if(clearTimeout(r),!e.ok)throw b("Error en respuesta: ".concat(e.status," ").concat(e.statusText)),Error("Error al obtener propiedad: ".concat(e.status," ").concat(e.statusText));b("Intentando obtener JSON de la respuesta");let t=await e.json();b("JSON obtenido correctamente"),m(t),b("Diagn\xf3stico completado con \xe9xito")}catch(e){b("Error en diagn\xf3stico: ".concat(e.message)),console.error("Error en diagn\xf3stico:",e),h(e.message||"Error desconocido")}finally{i(!1)}};return(0,s.jsxs)(c.A,{children:[(0,s.jsxs)(n(),{children:[(0,s.jsx)("title",{children:"Diagn\xf3stico de Propiedades | Goza Madrid"}),(0,s.jsx)("meta",{name:"robots",content:"noindex, nofollow"})]}),(0,s.jsxs)("div",{className:"container mx-auto py-8 px-4",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Diagn\xf3stico de Propiedades"}),(0,s.jsx)("form",{onSubmit:g,className:"mb-8",children:(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,s.jsx)("input",{type:"text",value:o,onChange:e=>a(e.target.value),placeholder:"ID de la propiedad",className:"flex-grow p-3 border border-gray-300 rounded"}),(0,s.jsx)("button",{type:"submit",disabled:t,className:"px-6 py-3 rounded font-bold ".concat(t?"bg-gray-400":"bg-amber-400 hover:bg-amber-500"," text-black"),children:t?"Cargando...":"Diagnosticar"})]})}),p&&(0,s.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6",children:[(0,s.jsx)("h2",{className:"font-bold text-lg mb-2",children:"Error"}),(0,s.jsx)("p",{children:p})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"bg-gray-100 p-4 rounded",children:[(0,s.jsx)("h2",{className:"font-bold text-lg mb-2",children:"Logs"}),(0,s.jsx)("div",{className:"bg-black text-green-400 p-4 rounded h-96 overflow-y-auto font-mono text-sm",children:0===x.length?(0,s.jsx)("p",{className:"text-gray-500",children:"No hay logs disponibles"}):x.map((e,o)=>(0,s.jsxs)("div",{className:"mb-1",children:[(0,s.jsxs)("span",{className:"text-gray-500",children:["[",e.time.split("T")[1].split(".")[0],"]"]})," ",e.message]},o))})]}),(0,s.jsxs)("div",{className:"bg-gray-100 p-4 rounded",children:[(0,s.jsx)("h2",{className:"font-bold text-lg mb-2",children:"Resultado"}),(0,s.jsx)("div",{className:"bg-white border border-gray-300 p-4 rounded h-96 overflow-y-auto",children:t?(0,s.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-amber-400"})}):l?(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-bold text-xl mb-2",children:l.title||l.name||"Propiedad sin t\xedtulo"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-bold",children:"ID:"}),(0,s.jsx)("p",{children:l._id||l.id||"No disponible"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-bold",children:"Tipo:"}),(0,s.jsx)("p",{children:l.source||"No disponible"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-bold",children:"Precio:"}),(0,s.jsx)("p",{children:l.price||"No disponible"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-bold",children:"Ubicaci\xf3n:"}),(0,s.jsx)("p",{children:l.location||"No disponible"})]})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("p",{className:"font-bold",children:"Im\xe1genes:"}),l.images&&l.images.length>0?(0,s.jsx)("ul",{className:"list-disc pl-5",children:l.images.map((e,o)=>(0,s.jsx)("li",{className:"truncate",children:"string"==typeof e?e:e.src||"Objeto de imagen sin URL"},o))}):(0,s.jsx)("p",{children:"No hay im\xe1genes disponibles"})]}),(0,s.jsxs)("details",{children:[(0,s.jsx)("summary",{className:"cursor-pointer font-bold",children:"Ver JSON completo"}),(0,s.jsx)("pre",{className:"bg-gray-100 p-2 rounded mt-2 text-xs overflow-x-auto",children:JSON.stringify(l,null,2)})]})]}):(0,s.jsx)("p",{className:"text-gray-500",children:"No hay resultados disponibles"})})]})]})]})]})}a(20225)}},e=>{var o=o=>e(e.s=o);e.O(0,[2534,225,6593,636,8792],()=>o(89546)),_N_E=e.O()}]);