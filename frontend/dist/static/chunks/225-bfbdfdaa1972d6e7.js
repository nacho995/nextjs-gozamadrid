"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[225],{20225:(e,o,t)=>{t.d(o,{dZ:()=>s,g6:()=>i,wu:()=>c,xc:()=>l});var a=t(7814);t(12534).Buffer;let r=window.appConfig?window.appConfig.apiUrl:"https://goza-madrid.onrender.com";async function i(){let e=[];try{console.log("[DEBUG getBlogPosts] Iniciando solicitud a WordPress");let o=await fetch("/api/wordpress-proxy?endpoint=wp&path=posts&per_page=10&_embed=true");if(!o.ok){console.error("Error al obtener blogs de WordPress: ".concat(o.status," ").concat(o.statusText));try{let e=await o.text();console.error("Detalle del error: ".concat(e.substring(0,200)))}catch(e){console.error("No se pudo leer el error:",e)}throw Error("Error al obtener blogs: ".concat(o.status))}let t=o.headers.get("content-type");if(!t||!t.includes("application/json")){console.error("WordPress devolvi\xf3 un tipo de contenido no JSON: ".concat(t));let e=await o.text();throw console.error("Primeros 200 caracteres: ".concat(e.substring(0,200))),Error("Respuesta no es JSON")}let a=await o.json();if(console.log("[DEBUG getBlogPosts] Blogs obtenidos: ".concat(Array.isArray(a)?a.length:"No es un array")),Array.isArray(a)&&a.length>0)a.forEach(o=>{var t,a,r,i,n,s;let l=null;if(o._embedded&&o._embedded["wp:featuredmedia"]&&o._embedded["wp:featuredmedia"][0]){let e=o._embedded["wp:featuredmedia"][0];if(e.media_details&&e.media_details.sizes){for(let o of["medium_large","medium","large","full"])if(e.media_details.sizes[o]){l=e.media_details.sizes[o].source_url;break}}!l&&e.source_url&&(l=e.source_url)}!l&&o.uagb_featured_image_src&&(l=(null===(n=o.uagb_featured_image_src.medium)||void 0===n?void 0:n[0])||(null===(s=o.uagb_featured_image_src.full)||void 0===s?void 0:s[0])),l||(l="/img/default-blog-image.jpg"),e.push({...o,image:{src:l,alt:(null===(t=o.title)||void 0===t?void 0:t.rendered)||o.title||"Imagen del blog"},title:(null===(a=o.title)||void 0===a?void 0:a.rendered)||o.title||"",content:(null===(r=o.content)||void 0===r?void 0:r.rendered)||o.content||"",excerpt:(null===(i=o.excerpt)||void 0===i?void 0:i.rendered)||o.excerpt||"",source:"wordpress"})});else{let e=await o.json();console.error("Error al obtener blogs de WordPress: ".concat(o.status),e)}}catch(e){console.error("Error con WordPress:",e.message)}try{let o=await fetch("".concat(r,"/blog"),{method:"GET",headers:{"Content-Type":"application/json"}});if(o.ok){let t=o.headers.get("content-type");t&&t.includes("application/json")?(await o.json()).forEach(o=>{let t=[];if(o.images&&Array.isArray(o.images)&&o.images.length>0)t=o.images.map(e=>{let t="string"==typeof e?e:e.src||"";return{src:t.startsWith("http")?t:"".concat(r).concat(t.startsWith("/")?"":"/").concat(t),alt:"object"==typeof e&&e.alt?e.alt:o.title||"Imagen del blog"}});else if(o.image){if("string"==typeof o.image)t=[{src:o.image.startsWith("http")?o.image:"".concat(r).concat(o.image.startsWith("/")?"":"/").concat(o.image),alt:o.title||"Imagen del blog"}];else{let e=o.image.src||o.image.url||"";t=[{...o.image,src:e.startsWith("http")?e:"".concat(r).concat(e.startsWith("/")?"":"/").concat(e)}]}}else t=[{src:"/img/default-blog-image.jpg",alt:o.title||"Imagen del blog"}];e.push({...o,_id:o._id||"mongo-".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2,9)),title:o.title||"Sin t\xedtulo",content:o.content||o.description||"",description:o.description||o.excerpt||"",date:o.createdAt||o.date||new Date().toISOString(),dateFormatted:o.dateFormatted||(o.createdAt?new Date(o.createdAt).toLocaleDateString("es-ES"):new Date().toLocaleDateString("es-ES")),images:t,image:t[0]||{src:"/img/default-blog-image.jpg",alt:"Imagen del blog"},source:"mongodb"})}):console.error("La respuesta no es JSON v\xe1lido:",await o.text())}else try{let e=await o.text();console.error("Error al obtener blogs de MongoDB: ".concat(o.status),e)}catch(e){console.error("Error al obtener blogs de MongoDB: ".concat(o.status),o.statusText)}}catch(e){console.error("Error con MongoDB:",e.message)}return e}async function n(e){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{maxRetries:t=5,initialTimeout:a=2e3,maxTimeout:r=3e4,factor:i=2,isProduction:n=!0}=o,s=1,l=a,c=null;for(;s<=(n?t:2);)try{console.log("[DEBUG] Intento ".concat(s," de ").concat(n?t:2));let o=1e3*Math.random(),a=Math.min(l+o,r);return s>1&&(console.log("[DEBUG] Esperando ".concat(Math.round(a),"ms antes del siguiente intento")),await new Promise(e=>setTimeout(e,a))),await e()}catch(e){if(console.error("[DEBUG] Error en intento ".concat(s,":"),e),c=e,l=Math.min(l*i,r),++s>(n?t:2))throw c}throw c||Error("Error despu\xe9s de m\xfaltiples intentos")}async function s(e){try{console.log("[DEBUG] Iniciando getBlogById para ID: ".concat(e));let o=/^[0-9a-fA-F]{24}$/.test(e),t=async()=>{let t=new AbortController,a=setTimeout(()=>{console.log("[DEBUG] Timeout alcanzado, abortando petici\xf3n"),t.abort()},3e4);try{let i;if(o){let o="".concat("","/blog/").concat(e);i=await fetch(o,{signal:t.signal,headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}})}else{let o="/api/wordpress-proxy?endpoint=wp&path=posts/".concat(e,"&_embed=true");i=await fetch(o,{signal:t.signal,headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}})}if(clearTimeout(a),!i.ok)throw Error("Error HTTP: ".concat(i.status));let n=await i.json();return o?function(e){var o;let t=[];if(e.images&&Array.isArray(e.images)&&e.images.length>0)t=e.images.map(o=>{let t="string"==typeof o?o:o.src||"";return{src:t.startsWith("http")?t:"".concat(r).concat(t.startsWith("/")?"":"/").concat(t),alt:"object"==typeof o&&o.alt?o.alt:e.title||"Imagen del blog"}});else if(e.image){if("string"==typeof e.image)t=[{src:e.image.startsWith("http")?e.image:"".concat(r).concat(e.image.startsWith("/")?"":"/").concat(e.image),alt:e.title||"Imagen del blog"}];else{let o=e.image.src||e.image.url||"";t=[{...e.image,src:o.startsWith("http")?o:"".concat(r).concat(o.startsWith("/")?"":"/").concat(o)}]}}return 0===t.length&&(t=[{src:"/img/default-blog-image.jpg",alt:e.title||"Imagen del blog"}]),{...e,_id:e._id,title:e.title||"Sin t\xedtulo",content:e.content||e.description||"",description:e.description||e.excerpt||"",date:e.createdAt||e.date||new Date().toISOString(),dateFormatted:e.dateFormatted||(e.createdAt?new Date(e.createdAt).toLocaleDateString("es-ES"):new Date().toLocaleDateString("es-ES")),images:t,image:t[0],imageUrl:(null===(o=t[0])||void 0===o?void 0:o.src)||"/img/default-blog-image.jpg",source:"mongodb"}}(n):function(e){var o,t,a,r,i,n,s;let l=null;if(e._embedded&&e._embedded["wp:featuredmedia"]&&e._embedded["wp:featuredmedia"][0]){let o=e._embedded["wp:featuredmedia"][0];if(o.media_details&&o.media_details.sizes){for(let e of["medium_large","medium","large","full"])if(o.media_details.sizes[e]){l=o.media_details.sizes[e].source_url;break}}!l&&o.source_url&&(l=o.source_url)}return!l&&e.uagb_featured_image_src&&(l=(null===(n=e.uagb_featured_image_src.medium)||void 0===n?void 0:n[0])||(null===(s=e.uagb_featured_image_src.full)||void 0===s?void 0:s[0])),l||(l="/img/default-blog-image.jpg"),{...e,_id:"wp-".concat(e.id),id:e.id,title:(null===(o=e.title)||void 0===o?void 0:o.rendered)||e.title||"",content:(null===(t=e.content)||void 0===t?void 0:t.rendered)||e.content||"",excerpt:(null===(a=e.excerpt)||void 0===a?void 0:a.rendered)||e.excerpt||"",date:e.date,dateFormatted:new Date(e.date).toLocaleDateString("es-ES"),images:[{src:l,alt:(null===(r=e.title)||void 0===r?void 0:r.rendered)||e.title||"Imagen del blog"}],image:{src:l,alt:(null===(i=e.title)||void 0===i?void 0:i.rendered)||e.title||"Imagen del blog"},imageUrl:l,slug:e.slug,source:"wordpress"}}(n)}catch(e){throw clearTimeout(a),e}};return await n(t,{maxRetries:7,initialTimeout:2e3,maxTimeout:3e4,factor:1.5,isProduction:!0})}catch(e){throw console.error("[DEBUG] Error final en getBlogById:",e),e}}async function l(){let e=[],o=[];console.log("Iniciando getPropertyPosts - Recuperando propiedades de WooCommerce y MongoDB");try{console.log("[DEBUG getPropertyPosts] Iniciando solicitud a WooCommerce"),console.log("Config WC_API_URL:",window.CONFIG?window.CONFIG.WC_API_URL:"No disponible"),console.log("Config WOO_COMMERCE_KEY:",window.CONFIG?window.CONFIG.WOO_COMMERCE_KEY?"Configurado":"No configurado":"No disponible");let o=[];for(let e=1;e<=3;e++)try{console.log("[DEBUG getPropertyPosts] Solicitando p\xe1gina ".concat(e," de WooCommerce..."));let t="/api/woocommerce-proxy?endpoint=products&page=".concat(e,"&per_page=100");console.log("[DEBUG getPropertyPosts] URL del proxy:",t);let a=new AbortController,r=setTimeout(()=>a.abort(),6e4),i=await fetch(t,{signal:a.signal,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}}).finally(()=>clearTimeout(r));if(!i.ok){console.error("Error al obtener p\xe1gina ".concat(e," de WooCommerce: ").concat(i.status," ").concat(i.statusText));try{let e=await i.text();console.error("Cuerpo de error:",e)}catch(e){console.error("No se pudo leer el cuerpo del error:",e)}break}let n=i.headers.get("content-type");if(!n||!n.includes("application/json")){console.error("Respuesta no es JSON. Content-Type: ".concat(n));try{let e=await i.text();console.error("Contenido de la respuesta (primeros 500 caracteres):",e.substring(0,500))}catch(e){console.error("No se pudo leer la respuesta:",e)}break}let s=await i.json();if(console.log("[DEBUG getPropertyPosts] Recibidos ".concat(s?Array.isArray(s)?s.length:"no es un array":"undefined"," productos de WooCommerce en p\xe1gina ").concat(e)),!s){console.error("La respuesta es undefined");break}if(!Array.isArray(s)){console.error("La respuesta no es un array:",s);break}if(0===s.length){console.log("No hay m\xe1s productos en la p\xe1gina ".concat(e));break}if(o.push(...s),s.length<100)break}catch(o){console.error("Error al obtener p\xe1gina ".concat(e,":"),o);break}console.log("Total de productos recuperados de WooCommerce: ".concat(o.length)),e=o.map(e=>{var o,t,a,r,i,n,s,l;let c=null===(t=e.meta_data)||void 0===t?void 0:null===(o=t.find(e=>"address"===e.key))||void 0===o?void 0:o.value,d="";if(c){if("object"==typeof c&&c.address){let e=c.address.toString();e.includes("Australia")||e.includes("WA,")||(d=e)}else"string"==typeof c&&(d=c)}let g=(null===(r=e.meta_data)||void 0===r?void 0:null===(a=r.find(e=>"bedrooms"===e.key))||void 0===a?void 0:a.value)||"0",p=(null===(n=e.meta_data)||void 0===n?void 0:null===(i=n.find(e=>"ba\xf1os"===e.key))||void 0===i?void 0:i.value)||"0",m=(null===(l=e.meta_data)||void 0===l?void 0:null===(s=l.find(e=>"living_area"===e.key))||void 0===s?void 0:s.value)||"0",u=e.short_description||e.description||"",f=e.name||"",h=f.split(",")[0].trim(),b=e.id.toString(),y={3945:["Calle Colegiata","Calle Colegiata, Madrid",4,2,167],3895:["Calle Mejico","Calle Mejico, Madrid",2,1,66],3772:["Hermosilla","Calle Hermosilla, Madrid",3,2,137],3313:["Lope De Rueda 29","Lope De Rueda 29, 4\xbaCentro-Derecha, Madrid",2,2,133],3291:["Jorge Juan 98","Calle Jorge Juan 98, Madrid",2,2,144],3268:["Castell\xf3 120","Calle Castell\xf3 120, Madrid",2,2,114],3157:["Alcalde Sainz De Baranda","Calle Alcalde Sainz De Baranda, Madrid",2,2,111],2844:["Goya 19","Calle Goya 19, Madrid",2,2,115],2829:["Pr\xedncipe De Vergara 71","Calle Pr\xedncipe De Vergara 71, Madrid",4,4,223],2763:["Castell\xf3 109","Calle Castell\xf3 109, Madrid",3,2,125]}[b]||null,w=parseInt(g)||0,_=parseInt(p)||0,v=parseInt(m)||0;w<=0&&(w=y?y[2]:2),_<=0&&(_=y?y[3]:1),v<=0&&(v=y?y[4]:100);let C="";d&&d.length>5?C=d:y?C=y[1]:(C=f).toLowerCase().includes("madrid")||(C+=", Madrid");let E=h||(y?y[0]:"Propiedad en Madrid");return{id:b,title:E,name:f,description:u,price:parseFloat(e.price),currency:"€",address:C,bedrooms:w,bathrooms:_,area:v,size:v,images:e.images?e.images.map(o=>({src:o.src,alt:o.alt||e.name})):[],features:[],categories:e.categories?e.categories.map(e=>e.name):[],source:"woocommerce",createdAt:e.date_created,updatedAt:e.date_modified}}),console.log("Procesadas ".concat(e.length," propiedades de WooCommerce"))}catch(e){console.error("Error al obtener propiedades de WooCommerce:",e)}try{let e=await fetch("/api/properties?per_page=100");if(e.ok){let t=await e.json();t&&t.properties&&(o=(Array.isArray(t.properties)?t.properties:t.properties?[t.properties]:[]).filter(e=>"mongodb"===e.source),console.log("Obtenidas ".concat(o.length," propiedades de MongoDB desde API combinada")))}else{console.error("Error al obtener propiedades de la API combinada: ".concat(e.status));let t=await fetch("".concat(r,"/property"));if(t.ok){let e=await t.json();o=(Array.isArray(e)?e:e.properties&&Array.isArray(e.properties)?e.properties:[]).map(e=>({...e,source:"mongodb"})),console.log("Obtenidas ".concat(o.length," propiedades directamente de MongoDB"))}}}catch(e){console.error("Error al obtener propiedades de MongoDB:",e)}let t=[...o,...e];return(console.log("Total de propiedades combinadas: ".concat(t.length)),console.log("Propiedades de WooCommerce:",e.length),console.log("Propiedades de MongoDB:",o.length),Array.isArray(t))?t:(console.error("getPropertyPosts: combinedData no es un array",t),[])}a.env.NEXT_PUBLIC_NEXT_PUBLIC_WOO_COMMERCE_KEY;let c=async e=>{try{let o=window.appConfig?window.appConfig.apiUrl:"https://goza-madrid.onrender.com";if(console.log("[DEBUG] Enviando solicitud de visita a propiedad a:","".concat(o,"/api/property-visit/create/")),!e.name||!e.email||!e.phone)return console.error("Faltan datos obligatorios para visita de propiedad:",e),{success:!1,message:"Faltan datos requeridos: nombre, email y tel\xe9fono son obligatorios",error:"Validaci\xf3n local",ok:!1};let t=await fetch("".concat(o,"/api/property-visit/create/"),{method:"POST",headers:{"Content-Type":"application/json",Origin:window.location.origin},body:JSON.stringify(e)}),a=t.headers.get("content-type");if(console.log("[DEBUG] Respuesta recibida:",t.status,a),a&&a.includes("application/json")){let e=await t.json();return e.ok=t.ok,e}{let e=await t.text();return console.error("Respuesta no JSON:",e),{success:!1,message:"El servidor no respondi\xf3 con un formato JSON v\xe1lido",error:e,ok:!1}}}catch(e){return console.error("Error al enviar solicitud de visita:",e),{success:!1,message:"Error de conexi\xf3n: "+e.message,error:e.message,ok:!1}}}}}]);