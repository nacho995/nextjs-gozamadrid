"use strict";exports.id=675,exports.ids=[675],exports.modules={28311:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},67659:(e,t,r)=>{r.r(t),r.d(t,{API_URL:()=>o,WC_CONSUMER_KEY:()=>a,WC_CONSUMER_SECRET:()=>s,default:()=>h,deleteBlogPost:()=>d,getBlogById:()=>g,getBlogPosts:()=>l,getCountryPrefix:()=>n,getPropertyById:()=>p,getPropertyPosts:()=>m,handleApiError:()=>i,sendEmail:()=>u,sendPropertyEmail:()=>f});let o="https://goza-madrid.onrender.com",a=process.env.NEXT_PUBLIC_NEXT_PUBLIC_WOO_COMMERCE_KEY,s="cs_a1757851d6db34bf9fb669c3ce6ef5a0dc855b5e",i=(e,t)=>{if(console.error(`Error en ${t}:`,e),e.response)throw Error(`Error ${e.response.status}: ${e.response.statusText}`);if(e.request)throw Error("No se recibi\xf3 respuesta del servidor");throw Error(e.message||"Error desconocido")};async function n(){try{let e=new AbortController,t=setTimeout(()=>e.abort(),5e3),r=await fetch(`${o}/prefix`,{method:"GET",headers:{"Content-Type":"application/json"},signal:e.signal});if(clearTimeout(t),r.ok){let e=r.headers.get("content-type");if(e&&e.includes("application/json"))return await r.json()}return getDefaultCountryPrefixes()}catch(e){return console.error("Error al obtener prefijos de pa\xeds:",e.message),getDefaultCountryPrefixes()}}async function l(){let e=[];try{console.log("[DEBUG getBlogPosts] Iniciando solicitud a WordPress");let t=await fetch("/api/wordpress-proxy?endpoint=wp&path=posts&per_page=10&_embed=true");if(!t.ok){console.error(`Error al obtener blogs de WordPress: ${t.status} ${t.statusText}`);try{let e=await t.text();console.error(`Detalle del error: ${e.substring(0,200)}`)}catch(e){console.error("No se pudo leer el error:",e)}throw Error(`Error al obtener blogs: ${t.status}`)}let r=t.headers.get("content-type");if(!r||!r.includes("application/json")){console.error(`WordPress devolvi\xf3 un tipo de contenido no JSON: ${r}`);let e=await t.text();throw console.error(`Primeros 200 caracteres: ${e.substring(0,200)}`),Error("Respuesta no es JSON")}let o=await t.json();if(console.log(`[DEBUG getBlogPosts] Blogs obtenidos: ${Array.isArray(o)?o.length:"No es un array"}`),Array.isArray(o)&&o.length>0)o.forEach(t=>{let r=null;if(t._embedded&&t._embedded["wp:featuredmedia"]&&t._embedded["wp:featuredmedia"][0]){let e=t._embedded["wp:featuredmedia"][0];if(e.media_details&&e.media_details.sizes){for(let t of["medium_large","medium","large","full"])if(e.media_details.sizes[t]){r=e.media_details.sizes[t].source_url;break}}!r&&e.source_url&&(r=e.source_url)}!r&&t.uagb_featured_image_src&&(r=t.uagb_featured_image_src.medium?.[0]||t.uagb_featured_image_src.full?.[0]),r||(r="/img/default-blog-image.jpg"),e.push({...t,image:{src:r,alt:t.title?.rendered||t.title||"Imagen del blog"},title:t.title?.rendered||t.title||"",content:t.content?.rendered||t.content||"",excerpt:t.excerpt?.rendered||t.excerpt||"",source:"wordpress"})});else{let e=await t.json();console.error(`Error al obtener blogs de WordPress: ${t.status}`,e)}}catch(e){console.error("Error con WordPress:",e.message)}try{let t=await fetch(`${o}/blog`,{method:"GET",headers:{"Content-Type":"application/json"}});if(t.ok){let r=t.headers.get("content-type");r&&r.includes("application/json")?(await t.json()).forEach(t=>{let r=[];if(t.images&&Array.isArray(t.images)&&t.images.length>0)r=t.images.map(e=>{let r="string"==typeof e?e:e.src||"";return{src:r.startsWith("http")?r:`${o}${r.startsWith("/")?"":"/"}${r}`,alt:"object"==typeof e&&e.alt?e.alt:t.title||"Imagen del blog"}});else if(t.image){if("string"==typeof t.image)r=[{src:t.image.startsWith("http")?t.image:`${o}${t.image.startsWith("/")?"":"/"}${t.image}`,alt:t.title||"Imagen del blog"}];else{let e=t.image.src||t.image.url||"";r=[{...t.image,src:e.startsWith("http")?e:`${o}${e.startsWith("/")?"":"/"}${e}`}]}}else r=[{src:"/img/default-blog-image.jpg",alt:t.title||"Imagen del blog"}];e.push({...t,_id:t._id||`mongo-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,title:t.title||"Sin t\xedtulo",content:t.content||t.description||"",description:t.description||t.excerpt||"",date:t.createdAt||t.date||new Date().toISOString(),dateFormatted:t.dateFormatted||(t.createdAt?new Date(t.createdAt).toLocaleDateString("es-ES"):new Date().toLocaleDateString("es-ES")),images:r,image:r[0]||{src:"/img/default-blog-image.jpg",alt:"Imagen del blog"},source:"mongodb"})}):console.error("La respuesta no es JSON v\xe1lido:",await t.text())}else try{let e=await t.text();console.error(`Error al obtener blogs de MongoDB: ${t.status}`,e)}catch(e){console.error(`Error al obtener blogs de MongoDB: ${t.status}`,t.statusText)}}catch(e){console.error("Error con MongoDB:",e.message)}return e}async function d(e){return(await fetch(`${o}/blog/${e}`,{method:"DELETE"})).json()}async function c(e,t={}){let{maxRetries:r=5,initialTimeout:o=2e3,maxTimeout:a=3e4,factor:s=2,isProduction:i=!0}=t,n=1,l=o,d=null;for(;n<=(i?r:2);)try{console.log(`[DEBUG] Intento ${n} de ${i?r:2}`);let t=1e3*Math.random(),o=Math.min(l+t,a);return n>1&&(console.log(`[DEBUG] Esperando ${Math.round(o)}ms antes del siguiente intento`),await new Promise(e=>setTimeout(e,o))),await e()}catch(e){if(console.error(`[DEBUG] Error en intento ${n}:`,e),d=e,l=Math.min(l*s,a),++n>(i?r:2))throw d}throw d||Error("Error despu\xe9s de m\xfaltiples intentos")}async function g(e){try{console.log(`[DEBUG] Iniciando getBlogById para ID: ${e}`);let t=/^[0-9a-fA-F]{24}$/.test(e),r=async()=>{let r=new AbortController,a=setTimeout(()=>{console.log("[DEBUG] Timeout alcanzado, abortando petici\xf3n"),r.abort()},3e4);try{let s;if(t){let t=`${o}/blog/${e}`;s=await fetch(t,{signal:r.signal,headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}})}else{let t=`/api/wordpress-proxy?endpoint=wp&path=posts/${e}&_embed=true`;s=await fetch(t,{signal:r.signal,headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}})}if(clearTimeout(a),!s.ok)throw Error(`Error HTTP: ${s.status}`);let i=await s.json();return t?function(e){let t=[];if(e.images&&Array.isArray(e.images)&&e.images.length>0)t=e.images.map(t=>{let r="string"==typeof t?t:t.src||"";return{src:r.startsWith("http")?r:`${o}${r.startsWith("/")?"":"/"}${r}`,alt:"object"==typeof t&&t.alt?t.alt:e.title||"Imagen del blog"}});else if(e.image){if("string"==typeof e.image)t=[{src:e.image.startsWith("http")?e.image:`${o}${e.image.startsWith("/")?"":"/"}${e.image}`,alt:e.title||"Imagen del blog"}];else{let r=e.image.src||e.image.url||"";t=[{...e.image,src:r.startsWith("http")?r:`${o}${r.startsWith("/")?"":"/"}${r}`}]}}return 0===t.length&&(t=[{src:"/img/default-blog-image.jpg",alt:e.title||"Imagen del blog"}]),{...e,_id:e._id,title:e.title||"Sin t\xedtulo",content:e.content||e.description||"",description:e.description||e.excerpt||"",date:e.createdAt||e.date||new Date().toISOString(),dateFormatted:e.dateFormatted||(e.createdAt?new Date(e.createdAt).toLocaleDateString("es-ES"):new Date().toLocaleDateString("es-ES")),images:t,image:t[0],imageUrl:t[0]?.src||"/img/default-blog-image.jpg",source:"mongodb"}}(i):function(e){let t=null;if(e._embedded&&e._embedded["wp:featuredmedia"]&&e._embedded["wp:featuredmedia"][0]){let r=e._embedded["wp:featuredmedia"][0];if(r.media_details&&r.media_details.sizes){for(let e of["medium_large","medium","large","full"])if(r.media_details.sizes[e]){t=r.media_details.sizes[e].source_url;break}}!t&&r.source_url&&(t=r.source_url)}return!t&&e.uagb_featured_image_src&&(t=e.uagb_featured_image_src.medium?.[0]||e.uagb_featured_image_src.full?.[0]),t||(t="/img/default-blog-image.jpg"),{...e,_id:`wp-${e.id}`,id:e.id,title:e.title?.rendered||e.title||"",content:e.content?.rendered||e.content||"",excerpt:e.excerpt?.rendered||e.excerpt||"",date:e.date,dateFormatted:new Date(e.date).toLocaleDateString("es-ES"),images:[{src:t,alt:e.title?.rendered||e.title||"Imagen del blog"}],image:{src:t,alt:e.title?.rendered||e.title||"Imagen del blog"},imageUrl:t,slug:e.slug,source:"wordpress"}}(i)}catch(e){throw clearTimeout(a),e}};return await c(r,{maxRetries:7,initialTimeout:2e3,maxTimeout:3e4,factor:1.5,isProduction:!0})}catch(e){throw console.error("[DEBUG] Error final en getBlogById:",e),e}}async function m(){let e=[],t=[];console.log("Iniciando getPropertyPosts - Recuperando propiedades de WooCommerce y MongoDB");try{console.log("[DEBUG getPropertyPosts] Iniciando solicitud a WooCommerce"),console.log("Config WC_API_URL:","No disponible"),console.log("Config WOO_COMMERCE_KEY:","No disponible");let t=[];for(let e=1;e<=3;e++)try{console.log(`[DEBUG getPropertyPosts] Solicitando p\xe1gina ${e} de WooCommerce...`);let r=`/api/woocommerce-proxy?endpoint=products&page=${e}&per_page=100`;console.log("[DEBUG getPropertyPosts] URL del proxy:",r);let o=new AbortController,a=setTimeout(()=>o.abort(),6e4),s=await fetch(r,{signal:o.signal,headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}}).finally(()=>clearTimeout(a));if(!s.ok){console.error(`Error al obtener p\xe1gina ${e} de WooCommerce: ${s.status} ${s.statusText}`);try{let e=await s.text();console.error("Cuerpo de error:",e)}catch(e){console.error("No se pudo leer el cuerpo del error:",e)}break}let i=s.headers.get("content-type");if(!i||!i.includes("application/json")){console.error(`Respuesta no es JSON. Content-Type: ${i}`);try{let e=await s.text();console.error("Contenido de la respuesta (primeros 500 caracteres):",e.substring(0,500))}catch(e){console.error("No se pudo leer la respuesta:",e)}break}let n=await s.json();if(console.log(`[DEBUG getPropertyPosts] Recibidos ${n?Array.isArray(n)?n.length:"no es un array":"undefined"} productos de WooCommerce en p\xe1gina ${e}`),!n){console.error("La respuesta es undefined");break}if(!Array.isArray(n)){console.error("La respuesta no es un array:",n);break}if(0===n.length){console.log(`No hay m\xe1s productos en la p\xe1gina ${e}`);break}if(t.push(...n),n.length<100)break}catch(t){console.error(`Error al obtener p\xe1gina ${e}:`,t);break}console.log(`Total de productos recuperados de WooCommerce: ${t.length}`),e=t.map(e=>{let t=e.meta_data?.find(e=>"address"===e.key)?.value,r="";if(t){if("object"==typeof t&&t.address){let e=t.address.toString();e.includes("Australia")||e.includes("WA,")||(r=e)}else"string"==typeof t&&(r=t)}let o=e.meta_data?.find(e=>"bedrooms"===e.key)?.value||"0",a=e.meta_data?.find(e=>"ba\xf1os"===e.key)?.value||"0",s=e.meta_data?.find(e=>"living_area"===e.key)?.value||"0",i=e.short_description||e.description||"",n=e.name||"",l=n.split(",")[0].trim(),d=e.id.toString(),c={3945:["Calle Colegiata","Calle Colegiata, Madrid",4,2,167],3895:["Calle Mejico","Calle Mejico, Madrid",2,1,66],3772:["Hermosilla","Calle Hermosilla, Madrid",3,2,137],3313:["Lope De Rueda 29","Lope De Rueda 29, 4\xbaCentro-Derecha, Madrid",2,2,133],3291:["Jorge Juan 98","Calle Jorge Juan 98, Madrid",2,2,144],3268:["Castell\xf3 120","Calle Castell\xf3 120, Madrid",2,2,114],3157:["Alcalde Sainz De Baranda","Calle Alcalde Sainz De Baranda, Madrid",2,2,111],2844:["Goya 19","Calle Goya 19, Madrid",2,2,115],2829:["Pr\xedncipe De Vergara 71","Calle Pr\xedncipe De Vergara 71, Madrid",4,4,223],2763:["Castell\xf3 109","Calle Castell\xf3 109, Madrid",3,2,125]}[d]||null,g=parseInt(o)||0,m=parseInt(a)||0,p=parseInt(s)||0;g<=0&&(g=c?c[2]:2),m<=0&&(m=c?c[3]:1),p<=0&&(p=c?c[4]:100);let u="";r&&r.length>5?u=r:c?u=c[1]:(u=n).toLowerCase().includes("madrid")||(u+=", Madrid");let f=l||(c?c[0]:"Propiedad en Madrid");return{id:d,title:f,name:n,description:i,price:parseFloat(e.price),currency:"â‚¬",address:u,bedrooms:g,bathrooms:m,area:p,size:p,images:e.images?e.images.map(t=>({src:t.src,alt:t.alt||e.name})):[],features:[],categories:e.categories?e.categories.map(e=>e.name):[],source:"woocommerce",createdAt:e.date_created,updatedAt:e.date_modified}}),console.log(`Procesadas ${e.length} propiedades de WooCommerce`)}catch(e){console.error("Error al obtener propiedades de WooCommerce:",e)}try{let e=await fetch("/api/properties?per_page=100");if(e.ok){let r=await e.json();r&&r.properties&&(t=(Array.isArray(r.properties)?r.properties:r.properties?[r.properties]:[]).filter(e=>"mongodb"===e.source),console.log(`Obtenidas ${t.length} propiedades de MongoDB desde API combinada`))}else{console.error(`Error al obtener propiedades de la API combinada: ${e.status}`);let r=await fetch(`${o}/property`);if(r.ok){let e=await r.json();t=(Array.isArray(e)?e:e.properties&&Array.isArray(e.properties)?e.properties:[]).map(e=>({...e,source:"mongodb"})),console.log(`Obtenidas ${t.length} propiedades directamente de MongoDB`)}}}catch(e){console.error("Error al obtener propiedades de MongoDB:",e)}let r=[...t,...e];return(console.log(`Total de propiedades combinadas: ${r.length}`),console.log("Propiedades de WooCommerce:",e.length),console.log("Propiedades de MongoDB:",t.length),Array.isArray(r))?r:(console.error("getPropertyPosts: combinedData no es un array",r),[])}async function p(e){try{let t=/^[0-9a-fA-F]{24}$/.test(e),r=async()=>{let r=new AbortController,a=setTimeout(()=>{r.abort()},15e3);try{var s;let i,n;if(t){let t=`${o}/property/${e}`;i=await fetch(t,{signal:r.signal,headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}})}else{let t=`/api/wordpress-proxy?path=products/${e}`;i=await fetch(t,{signal:r.signal,headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}})}if(clearTimeout(a),!i.ok)throw Error(`Error HTTP: ${i.status}`);let l=await i.json();return t?function(e){let t=[];if(e.images){if(Array.isArray(e.images))t=e.images.map(e=>{if("string"==typeof e)return e.startsWith("http")?e:`${o}${e.startsWith("/")?"":"/"}${e}`;if("object"==typeof e&&e.src){let t=e.src.startsWith("http")?e.src:`${o}${e.src.startsWith("/")?"":"/"}${e.src}`;return{...e,src:t}}return e}).filter(e=>e);else if("string"==typeof e.images){let r=e.images;t=[r.startsWith("http")?r:`${o}${r.startsWith("/")?"":"/"}${r}`]}}return 0===t.length&&(t=["/img/default-property-image.jpg"]),{...e,_id:e._id,title:e.title||e.name||"Propiedad sin t\xedtulo",description:e.description||"",price:e.price||"0",location:e.location||"Madrid",bedrooms:e.bedrooms||e.rooms||0,bathrooms:e.bathrooms||e.wc||0,size:e.area||e.m2||0,images:t,source:"mongodb"}}(l):(s=l,n=[],s.images&&Array.isArray(s.images)&&s.images.length>0?n=s.images.map(e=>e.src||e).filter(e=>e):s.image&&s.image.src&&(n=[s.image.src]),0===n.length&&(n=["/img/default-property-image.jpg"]),{...s,id:s.id,title:s.name||"Propiedad sin t\xedtulo",description:s.description||"",price:s.price||"0",location:s.address||"Madrid",bedrooms:s.meta_data?.find(e=>"bedrooms"===e.key)?.value||0,bathrooms:s.meta_data?.find(e=>"bathrooms"===e.key)?.value||0,size:s.meta_data?.find(e=>"area"===e.key)?.value||0,images:n,source:"woocommerce"})}catch(e){throw clearTimeout(a),e}};return await c(r,{maxRetries:3,initialTimeout:1e3,maxTimeout:1e4,factor:1.5,isProduction:!0})}catch(e){throw console.error("Error final en getPropertyById:",e),e}}let u=async e=>{try{let t="https://goza-madrid.onrender.com";console.log("[DEBUG] Enviando formulario de contacto a:",`${t}/api/contact`);let r={nombre:e.name,email:e.email,prefix:e.prefix||"+34",telefono:e.phone||"",asunto:e.message};if(!r.nombre||!r.email)return console.error("Faltan datos obligatorios:",r),{success:!1,message:"Faltan datos requeridos: nombre y email son obligatorios",error:"Validaci\xf3n local",ok:!1};let o=`${t}/api/contact`,a=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Origin:"https://realestategozamadrid.com"},body:JSON.stringify(r)}),s=a.headers.get("content-type");if(console.log("[DEBUG] Respuesta recibida:",a.status,s),s&&s.includes("application/json")){let e=await a.json();return e.ok=a.ok,e}{let e=await a.text();return console.error("Respuesta no JSON:",e),{success:!1,message:"El servidor no respondi\xf3 con un formato JSON v\xe1lido",error:e,ok:!1}}}catch(e){return console.error("Error al enviar formulario:",e),{success:!1,message:"Error de conexi\xf3n: "+e.message,error:e.message,ok:!1}}},f=async e=>{try{let t="https://goza-madrid.onrender.com";if(console.log("[DEBUG] Enviando solicitud de visita a propiedad a:",`${t}/api/property-visit/create/`),!e.name||!e.email||!e.phone)return console.error("Faltan datos obligatorios para visita de propiedad:",e),{success:!1,message:"Faltan datos requeridos: nombre, email y tel\xe9fono son obligatorios",error:"Validaci\xf3n local",ok:!1};let r=`${t}/api/property-visit/create/`,o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Origin:"https://realestategozamadrid.com"},body:JSON.stringify(e)}),a=o.headers.get("content-type");if(console.log("[DEBUG] Respuesta recibida:",o.status,a),a&&a.includes("application/json")){let e=await o.json();return e.ok=o.ok,e}{let e=await o.text();return console.error("Respuesta no JSON:",e),{success:!1,message:"El servidor no respondi\xf3 con un formato JSON v\xe1lido",error:e,ok:!1}}}catch(e){return console.error("Error al enviar solicitud de visita:",e),{success:!1,message:"Error de conexi\xf3n: "+e.message,error:e.message,ok:!1}}};async function h(e,t){let{url:r}=e.query;if(!r)return t.status(400).json({error:"URL no proporcionada"});try{let e=await fetch(r),o=await e.arrayBuffer(),a=e.headers.get("content-type");t.setHeader("Content-Type",a),t.setHeader("Cache-Control","public, max-age=86400"),t.status(200).send(Buffer.from(o))}catch(e){console.error("Error al obtener imagen:",e),t.status(500).json({error:"Error al obtener la imagen"})}}},82755:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};