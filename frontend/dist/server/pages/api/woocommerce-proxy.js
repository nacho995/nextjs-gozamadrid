"use strict";(()=>{var e={};e.id=974,e.ids=[974],e.modules={10309:(e,o)=>{Object.defineProperty(o,"A",{enumerable:!0,get:function(){return r}});var r=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},15113:(e,o)=>{Object.defineProperty(o,"M",{enumerable:!0,get:function(){return function e(o,r){return r in o?o[r]:"then"in o&&"function"==typeof o.then?o.then(o=>e(o,r)):"function"==typeof o&&"default"===r?o:void 0}}})},23854:(e,o,r)=>{r.r(o),r.d(o,{config:()=>m,default:()=>u,routeModule:()=>p});var t={};r.r(t),r.d(t,{default:()=>d});var a=r(76438),s=r(10309),n=r(15113);let c=10,i=e=>new Promise(o=>setTimeout(o,e)),l=async(e,o,r=c,t=1)=>{try{let a=new AbortController,s=setTimeout(()=>a.abort(),18e4),n=await fetch(e,{...o,signal:a.signal,headers:{...o.headers,"User-Agent":"Mozilla/5.0 (compatible; GozaMadridBot/1.0)",Accept:"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(clearTimeout(s),(503===n.status||502===n.status||504===n.status||404===n.status)&&r>0){let a=Math.min(2e3*Math.pow(2,t-1),6e4);return console.log(`[WooCommerce Proxy] Error ${n.status} - Reintentando (${r} intentos restantes) despu\xe9s de ${a}ms...`),await i(a),l(e,o,r-1,t+1)}return n}catch(a){if("AbortError"===a.name){if(console.error("[WooCommerce Proxy] Timeout - La solicitud tard\xf3 demasiado"),r>0){let a=Math.min(2e3*Math.pow(2,t-1),6e4);return console.log(`[WooCommerce Proxy] Reintentando despu\xe9s del timeout despu\xe9s de ${a}ms...`),await i(a),l(e,o,r-1,t+1)}throw Error("Timeout - La solicitud tard\xf3 demasiado")}if(r>0){let s=Math.min(2e3*Math.pow(2,t-1),6e4);return console.log(`[WooCommerce Proxy] Error en la petici\xf3n: ${a.message} - Reintentando (${r} intentos restantes) despu\xe9s de ${s}ms...`),await i(s),l(e,o,r-1,t+1)}throw a}};async function d(e,o){try{let{path:r="products",...t}=e.query,a=`https://wordpress-1430059-5339263.cloudwaysapps.com/wp-json/wc/v3/${r}?consumer_key=ck_d69e61427264a7beea70ca9ee543b45dd00cae85&consumer_secret=cs_a1757851d6db34bf9fb669c3ce6ef5a0dc855b5e`;t.per_page||(t.per_page=100),Object.entries(t).forEach(([e,o])=>{"path"!==e&&(a+=`&${e}=${encodeURIComponent(o)}`)}),console.log("[WooCommerce Proxy] Conectando a WooCommerce:",a.replace(/consumer_secret=([^&]*)/,"consumer_secret=XXXXX"));let s=await l(a,{method:"GET",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0",Accept:"application/json","User-Agent":"Mozilla/5.0 (Node.js API Proxy)"}}),n=parseInt(s.headers.get("X-WP-TotalPages")||"1"),i=parseInt(s.headers.get("X-WP-Total")||"0");if(!s.ok){if(console.error(`[WooCommerce Proxy] Error en la respuesta despu\xe9s de ${c} intentos: ${s.status} ${s.statusText}`),503===s.status||502===s.status)return console.log("[WooCommerce Proxy] Servicio no disponible despu\xe9s de todos los reintentos, devolviendo array vac\xedo"),o.status(200).json([]);try{let e=await s.text();console.error("WooCommerce Proxy - Cuerpo del error:",e)}catch(e){console.error("WooCommerce Proxy - No se pudo leer el cuerpo del error")}return o.status(s.status).json({error:`Error al obtener datos de WooCommerce: ${s.status}`,message:s.statusText})}let d=await s.json();if(d=Array.isArray(d)?d:[d],n>1&&!t.page){console.log(`WooCommerce Proxy - Obteniendo todas las p\xe1ginas (${n} p\xe1ginas en total)`);let e=Array.from({length:n-1},(e,o)=>o+2).map(async e=>{let o=`${a}&page=${e}`,r=await l(o,{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0","User-Agent":"Mozilla/5.0 (compatible; GozaMadridBot/1.0)",Accept:"application/json"}});if(!r.ok)return console.error(`Error al obtener p\xe1gina ${e}: ${r.status}`),[];let t=await r.json();return Array.isArray(t)?t:[t]});(await Promise.allSettled(e)).forEach(e=>{"fulfilled"===e.status?d.push(...e.value):console.error("Error al obtener p\xe1gina adicional:",e.reason)})}return console.log(`WooCommerce Proxy - Total de elementos obtenidos: ${d.length}`),i&&o.setHeader("X-WP-Total",i),n&&o.setHeader("X-WP-TotalPages",n),o.status(200).json(d)}catch(e){return console.error("Error en el proxy de WooCommerce:",e),console.log("WooCommerce Proxy - Error irrecuperable, devolviendo array vac\xedo"),o.status(200).json([])}}let u=(0,n.M)(t,"default"),m=(0,n.M)(t,"config"),p=new a.PagesAPIRouteModule({definition:{kind:s.A.PAGES_API,page:"/api/woocommerce-proxy",pathname:"/api/woocommerce-proxy",bundlePath:"",filename:""},userland:t})},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},76438:(e,o,r)=>{e.exports=r(75600)}};var o=require("../../webpack-api-runtime.js");o.C(e);var r=o(o.s=23854);module.exports=r})();