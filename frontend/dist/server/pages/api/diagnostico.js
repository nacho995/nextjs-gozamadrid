"use strict";(()=>{var e={};e.id=417,e.ids=[417],e.modules={2036:(e,r,t)=>{t.r(r),t.d(r,{config:()=>u,default:()=>d,routeModule:()=>c});var o={};t.r(o),t.d(o,{default:()=>i});var a=t(76438),n=t(10309),s=t(15113);async function i(e,r){if("GET"!==e.method)return r.status(405).json({error:"M\xe9todo no permitido"});let{id:t}=e.query;if(!t)return r.status(400).json({error:"Se requiere un ID de propiedad"});let o=[],a=e=>{o.push({time:new Date().toISOString(),message:e})};try{let e;a(`Iniciando diagn\xf3stico para ID: ${t}`);let n=/^[0-9a-fA-F]{24}$/.test(t);a(`\xbfEs ID de MongoDB? ${n}`);let s="https://goza-madrid.onrender.com",i=new AbortController,d=setTimeout(()=>{a(`TIMEOUT alcanzado para la propiedad con ID: ${t}`),i.abort()},15e3);if(a(`Intentando cargar propiedad con ID: ${t}`),n){a(`Obteniendo propiedad de MongoDB con ID ${t}`);try{let r=`${s}/property/${t}`;a(`URL de petici\xf3n MongoDB: ${r}`),e=await fetch(r,{signal:i.signal,headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}}),a(`Respuesta MongoDB recibida: ${e.status} ${e.statusText}`)}catch(e){if(clearTimeout(d),a(`Error en fetch MongoDB: ${e.message}`),"AbortError"===e.name)return r.status(504).json({error:"Tiempo de espera agotado al obtener la propiedad",logs:o});throw e}}else{a(`Obteniendo propiedad de WooCommerce con ID ${t}`);try{let r=`${s}/api/wordpress-proxy?path=products/${t}`;a(`URL de petici\xf3n WooCommerce: ${r}`),e=await fetch(r,{signal:i.signal,headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}}),a(`Respuesta WooCommerce recibida: ${e.status} ${e.statusText}`)}catch(e){if(clearTimeout(d),a(`Error en fetch WooCommerce: ${e.message}`),"AbortError"===e.name)return r.status(504).json({error:"Tiempo de espera agotado al obtener la propiedad",logs:o});throw e}}if(clearTimeout(d),!e.ok)return a(`Error en respuesta: ${e.status} ${e.statusText}`),r.status(e.status).json({error:`Error al obtener propiedad: ${e.status} ${e.statusText}`,logs:o});a("Intentando obtener JSON de la respuesta");let u=await e.json();return a("JSON obtenido correctamente"),r.status(200).json({success:!0,data:u,logs:o})}catch(e){return a(`Error en diagn\xf3stico: ${e.message}`),console.error("Error en diagn\xf3stico:",e),r.status(500).json({error:e.message||"Error desconocido",logs:o})}}let d=(0,s.M)(o,"default"),u=(0,s.M)(o,"config"),c=new a.PagesAPIRouteModule({definition:{kind:n.A.PAGES_API,page:"/api/diagnostico",pathname:"/api/diagnostico",bundlePath:"",filename:""},userland:o})},10309:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})},15113:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},76438:(e,r,t)=>{e.exports=t(75600)}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=2036);module.exports=t})();